<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Emergency Requests - DUT Clinic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Previous CSS styles remain the same, adding new styles for completed requests */
        
        .student-card.completed {
            border-left: 4px solid var(--success);
            background-color: #f8fff9;
        }

        .status-completed {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .completed-message {
            text-align: center;
            padding: 10px;
            background-color: rgba(39, 174, 96, 0.1);
            border-radius: 4px;
            margin-top: 15px;
            color: var(--success);
            font-weight: 600;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Rest of the CSS remains the same as previous implementation */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --accent: #34495e;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --gray-light: #bdc3c7;
            --gray: #95a5a6;
            --gray-dark: #7f8c8d;
            --white: #ffffff;
            --dut-blue: #0033A0;
            --dut-orange: #FF6B00;
        }

        body {
            background-color: #f8f9fa;
            color: var(--secondary);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: linear-gradient(to bottom, var(--dut-blue), #002266);
            color: var(--white);
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hospital-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hospital-logo i {
            font-size: 24px;
            color: var(--dut-orange);
        }

        .hospital-logo h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-menu {
            list-style: none;
            flex: 1;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover, .sidebar-menu li.active a {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border-left: 3px solid var(--dut-orange);
        }

        .sidebar-menu i {
            width: 24px;
            margin-right: 10px;
            font-size: 16px;
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--dut-orange);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid var(--gray-light);
        }

        .header-left h1 {
            font-size: 24px;
            color: var(--dut-blue);
            margin-bottom: 5px;
        }

        .header-left p {
            color: var(--gray-dark);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-bell {
            position: relative;
            font-size: 20px;
            color: var(--secondary);
            cursor: pointer;
        }

        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--dut-orange);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--dut-blue);
            color: white;
        }

        .btn-primary:hover {
            background-color: #002266;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-warning {
            background-color: var(--dut-orange);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e55a00;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray);
            color: var(--gray-dark);
        }

        .btn-outline:hover {
            background-color: var(--gray);
            color: white;
        }

        /* Content Sections */
        .content-section {
            background-color: var(--white);
            border-radius: 10px;
            margin: 0 30px 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 1px solid var(--gray-light);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background-color: #f8f9fa;
        }

        .section-header h2 {
            font-size: 20px;
            color: var(--dut-blue);
        }

        /* Student List Styles */
        .student-list-container {
            padding: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }

        .filter-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
            background-color: var(--white);
            color: var(--secondary);
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .student-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray-light);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .student-card.pending {
            border-left: 4px solid var(--warning);
        }

        .student-card.urgent {
            border-left: 4px solid var(--danger);
        }

        .student-card.in-progress {
            border-left: 4px solid var(--dut-blue);
        }

        .student-card.completed {
            border-left: 4px solid var(--success);
            background-color: #f8fff9;
        }

        .student-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .student-info h3 {
            margin: 0 0 5px 0;
            color: var(--secondary);
        }

        .student-info p {
            margin: 0;
            color: var(--gray-dark);
            font-size: 14px;
        }

        .student-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .status-urgent {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .status-in-progress {
            background-color: rgba(0, 51, 160, 0.1);
            color: var(--dut-blue);
        }

        .status-completed {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .student-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }

        .detail-label {
            font-weight: 600;
            width: 120px;
            color: var(--secondary);
        }

        .detail-value {
            flex: 1;
            color: var(--gray-dark);
        }

        .reference-number {
            background-color: var(--dut-blue);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }

        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-warning {
            background-color: var(--warning);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger);
            color: white;
        }

        .badge-success {
            background-color: var(--success);
            color: white;
        }

        .badge-dut {
            background-color: var(--dut-orange);
            color: white;
        }

        .no-requests {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .no-requests i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--gray-light);
        }

        .campus-badge {
            background: linear-gradient(135deg, var(--dut-blue), var(--dut-orange));
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .completed-message {
            text-align: center;
            padding: 10px;
            background-color: rgba(39, 174, 96, 0.1);
            border-radius: 4px;
            margin-top: 15px;
            color: var(--success);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="hospital-logo">
                    <i class="fas fa-ambulance"></i>
                    <h2>DUT Paramedic Portal</h2>
                </div>
            </div>
            
            <ul class="sidebar-menu">
                <li><a href="paramedic-dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="emergency-records.html"><i class="fas fa-phone-alt"></i> Emergency Records</a></li>
                <li class="active"><a href="log-request.html"><i class="fas fa-clipboard-list"></i> Log Requests</a></li>
                <li><a href="patient-care.html"><i class="fas fa-heartbeat"></i> Patient Care</a></li>
                <li><a href="ambulance-status.html"><i class="fas fa-ambulance"></i> Ambulance Status</a></li>
                <li><a href="medical-supplies.html"><i class="fas fa-first-aid"></i> Medical Supplies</a></li>
                <li><a href="paramedic-schedule.html"><i class="fas fa-calendar-alt"></i> Schedule</a></li>
                <li><a href="messaging.html"><i class="fas fa-comments"></i> Messages</a></li>
                <li><a href="../index.html"><i class="fas fa-sign-out-alt"></i> Switch User</a></li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <img src="https://ui-avatars.com/api/?name=Paramedic+Alex&background=0033A0&color=fff" alt="Paramedic">
                    <div class="user-info">
                        <span class="user-name">Alex Morgan</span>
                        <span class="user-role">Senior Paramedic</span>
                    </div>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <h1>DUT Emergency Request Log</h1>
                    <p>Process and manage student emergency requests across DUT campuses</p>
                </div>
                <div class="header-right">
                    <div class="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="activeRequestsCount">14</span>
                    </div>
                    <a href="paramedic-dashboard.html" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </header>

            <div class="content-section">
                <div class="section-header">
                    <h2>Emergency Requests <span class="campus-badge">DUT CAMPUSES</span></h2>
                    <span class="badge badge-danger" id="totalRequestsCount">14 Requests</span>
                </div>
                
                <div class="student-list-container">
                    <div class="filters">
                        <div class="filter-group">
                            <label for="statusFilter">Filter by Status</label>
                            <select id="statusFilter" class="filter-control" onchange="filterRequests()">
                                <option value="all">All Requests</option>
                                <option value="pending">Pending</option>
                                <option value="urgent">Urgent</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="campusFilter">Filter by Campus</label>
                            <select id="campusFilter" class="filter-control" onchange="filterRequests()">
                                <option value="all">All Campuses</option>
                                <option value="mls">ML Sultan Campus</option>
                                <option value="ritson">Ritson Campus</option>
                                <option value="steve-biko">Steve Biko Campus</option>
                                <option value="b-block">B Block Residences</option>
                                <option value="m-block">M Block Residences</option>
                                <option value="brickfield">Brickfield Residences</option>
                                <option value="off-campus">Off-Campus</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="searchFilter">Search Students</label>
                            <input type="text" id="searchFilter" class="filter-control" placeholder="Search by name or ID..." onkeyup="filterRequests()">
                        </div>
                    </div>

                    <div class="student-grid" id="studentGrid">
                        <!-- Student cards will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Student emergency requests database with 14 students from DUT residences
        let emergencyRequests = [
            {
                id: '22123457',
                name: 'Dithebe Hlohonolofatso',
                age: 20,
                campus: 'ML Sultan Campus',
                residence: 'B Block Residences',
                room: 'B205',
                emergencyType: 'Severe Allergic Reaction',
                symptoms: 'Difficulty breathing, swelling, hives',
                timeReported: '2023-11-15 14:05',
                status: 'urgent',
                priority: 'high',
                reference: 'REF-DUT-2023-001',
                completed: false
            },
            {
                id: '22123458',
                name: 'Karabo Mokoena',
                age: 21,
                campus: 'Ritson Campus',
                residence: 'M Block Residences',
                room: 'M312',
                emergencyType: 'Suspected Fractured Arm',
                symptoms: 'Severe pain, swelling, inability to move arm',
                timeReported: '2023-11-15 14:12',
                status: 'urgent',
                priority: 'high',
                reference: 'REF-DUT-2023-002',
                completed: false
            },
            {
                id: '22123459',
                name: 'Ayanda Tema',
                age: 19,
                campus: 'Steve Biko Campus',
                residence: 'Brickfield Residences',
                room: 'BF108',
                emergencyType: 'Severe Asthma Attack',
                symptoms: 'Wheezing, shortness of breath, chest tightness',
                timeReported: '2023-11-15 14:18',
                status: 'urgent',
                priority: 'critical',
                reference: 'REF-DUT-2023-003',
                completed: false
            },
            {
                id: '22123460',
                name: 'Ngosha Munyai',
                age: 22,
                campus: 'Off-Campus',
                residence: 'Berea Road Apartments',
                room: 'Unit 4B',
                emergencyType: 'Chest Pain',
                symptoms: 'Sharp chest pain, dizziness, nausea',
                timeReported: '2023-11-15 14:25',
                status: 'urgent',
                priority: 'critical',
                reference: 'REF-DUT-2023-004',
                completed: false
            },
            {
                id: '22123461',
                name: 'Thembinkosi Mbatha',
                age: 20,
                campus: 'ML Sultan Campus',
                residence: 'B Block Residences',
                room: 'B421',
                emergencyType: 'Panic Attack',
                symptoms: 'Hyperventilation, chest pain, trembling',
                timeReported: '2023-11-15 14:30',
                status: 'pending',
                priority: 'medium',
                reference: 'REF-DUT-2023-005',
                completed: false
            },
            {
                id: '22123462',
                name: 'Mihle Dube',
                age: 23,
                campus: 'Ritson Campus',
                residence: 'M Block Residences',
                room: 'M112',
                emergencyType: 'Severe Migraine',
                symptoms: 'Blurred vision, nausea, sensitivity to light',
                timeReported: '2023-11-15 14:35',
                status: 'pending',
                priority: 'medium',
                reference: 'REF-DUT-2023-006',
                completed: false
            },
            {
                id: '22123463',
                name: 'Brian Dlamini',
                age: 19,
                campus: 'Steve Biko Campus',
                residence: 'Brickfield Residences',
                room: 'BF305',
                emergencyType: 'High Fever',
                symptoms: 'Fever 39.5°C, body aches, fatigue',
                timeReported: '2023-11-15 14:42',
                status: 'pending',
                priority: 'medium',
                reference: 'REF-DUT-2023-007',
                completed: false
            },
            {
                id: '22123464',
                name: 'Sne Ngobese',
                age: 21,
                campus: 'ML Sultan Campus',
                residence: 'B Block Residences',
                room: 'B315',
                emergencyType: 'Food Poisoning',
                symptoms: 'Vomiting, diarrhea, abdominal cramps',
                timeReported: '2023-11-15 14:48',
                status: 'pending',
                priority: 'medium',
                reference: 'REF-DUT-2023-008',
                completed: false
            },
            {
                id: '22123465',
                name: 'Muzi Mkhize',
                age: 20,
                campus: 'Ritson Campus',
                residence: 'M Block Residences',
                room: 'M208',
                emergencyType: 'Ankle Sprain',
                symptoms: 'Swelling, bruising, difficulty walking',
                timeReported: '2023-11-15 14:55',
                status: 'pending',
                priority: 'low',
                reference: 'REF-DUT-2023-009',
                completed: false
            },
            {
                id: '22123466',
                name: 'Kevin Wilson',
                age: 22,
                campus: 'Steve Biko Campus',
                residence: 'Brickfield Residences',
                room: 'BF112',
                emergencyType: 'Allergic Reaction',
                symptoms: 'Mild hives, itching, runny nose',
                timeReported: '2023-11-15 15:02',
                status: 'pending',
                priority: 'low',
                reference: 'REF-DUT-2023-010',
                completed: false
            },
            {
                id: '22123467',
                name: 'Maria Rodriguez',
                age: 19,
                campus: 'ML Sultan Campus',
                residence: 'B Block Residences',
                room: 'B405',
                emergencyType: 'Anxiety Attack',
                symptoms: 'Rapid heartbeat, sweating, feeling of panic',
                timeReported: '2023-11-15 15:08',
                status: 'in-progress',
                priority: 'medium',
                reference: 'REF-DUT-2023-011',
                completed: false
            },
            {
                id: '22123468',
                name: 'Thomas Anderson',
                age: 21,
                campus: 'Ritson Campus',
                residence: 'M Block Residences',
                room: 'M008',
                emergencyType: 'Back Injury',
                symptoms: 'Severe lower back pain, limited mobility',
                timeReported: '2023-11-15 15:15',
                status: 'in-progress',
                priority: 'high',
                reference: 'REF-DUT-2023-012',
                completed: false
            },
            {
                id: '22123469',
                name: 'Sophia Williams',
                age: 20,
                campus: 'Steve Biko Campus',
                residence: 'Brickfield Residences',
                room: 'BF212',
                emergencyType: 'Respiratory Infection',
                symptoms: 'Cough, fever, difficulty breathing',
                timeReported: '2023-11-15 15:22',
                status: 'pending',
                priority: 'medium',
                reference: 'REF-DUT-2023-013',
                completed: false
            },
            {
                id: '22123470',
                name: 'Daniel Kim',
                age: 23,
                campus: 'Off-Campus',
                residence: 'Musgrave Road Flats',
                room: 'Unit 7C',
                emergencyType: 'Eye Injury',
                symptoms: 'Chemical exposure, pain, blurred vision',
                timeReported: '2023-11-15 15:30',
                status: 'urgent',
                priority: 'high',
                reference: 'REF-DUT-2023-014',
                completed: false
            }
        ];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateRequestCounts();
            populateStudentGrid(emergencyRequests);
        });

        // Update request counts
        function updateRequestCounts() {
            const activeRequests = emergencyRequests.filter(req => !req.completed).length;
            const totalRequests = emergencyRequests.length;
            
            document.getElementById('activeRequestsCount').textContent = activeRequests;
            document.getElementById('totalRequestsCount').textContent = `${totalRequests} Requests`;
        }

        // Populate student grid
        function populateStudentGrid(students) {
            const studentGrid = document.getElementById('studentGrid');
            studentGrid.innerHTML = '';

            if (students.length === 0) {
                studentGrid.innerHTML = `
                    <div class="no-requests">
                        <i class="fas fa-clipboard-check"></i>
                        <h3>No Emergency Requests</h3>
                        <p>All emergency requests have been processed.</p>
                    </div>
                `;
                return;
            }

            students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = `student-card ${student.completed ? 'completed' : student.status}`;
                
                const actionButtons = student.completed ? 
                    `<div class="completed-message">
                        <i class="fas fa-check-circle"></i> Request Completed
                    </div>` :
                    `<div class="student-actions">
                        <button class="btn btn-primary btn-small" onclick="processRequest('${student.id}')">
                            <i class="fas fa-play-circle"></i> Process
                        </button>
                        <button class="btn btn-warning btn-small" onclick="assignAmbulance('${student.id}')">
                            <i class="fas fa-ambulance"></i> Dispatch
                        </button>
                        <button class="btn btn-outline btn-small" onclick="viewDetails('${student.id}')">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                    </div>`;
                
                studentCard.innerHTML = `
                    <div class="student-header">
                        <div class="student-info">
                            <h3>${student.name} <span class="campus-badge">${student.campus.split(' ')[0]}</span></h3>
                            <p>Student ID: ${student.id} • ${student.residence}, Room ${student.room}</p>
                        </div>
                        <span class="student-status status-${student.completed ? 'completed' : student.status}">
                            ${student.completed ? 'COMPLETED' : student.status.replace('-', ' ').toUpperCase()}
                        </span>
                    </div>
                    
                    <div class="student-details">
                        <div class="detail-row">
                            <div class="detail-label">Campus:</div>
                            <div class="detail-value">${student.campus}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Emergency Type:</div>
                            <div class="detail-value">${student.emergencyType}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Symptoms:</div>
                            <div class="detail-value">${student.symptoms}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Reported:</div>
                            <div class="detail-value">${student.timeReported}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Priority:</div>
                            <div class="detail-value">
                                <span class="badge ${
                                    student.priority === 'critical' ? 'badge-danger' : 
                                    student.priority === 'high' ? 'badge-dut' : 
                                    'badge-success'
                                }">
                                    ${student.priority.toUpperCase()}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="reference-number">
                        ${student.reference}
                    </div>
                    
                    ${actionButtons}
                `;
                
                studentGrid.appendChild(studentCard);
            });
        }

        // Filter requests based on selected filters
        function filterRequests() {
            const statusFilter = document.getElementById('statusFilter').value;
            const campusFilter = document.getElementById('campusFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

            let filteredStudents = emergencyRequests;

            // Filter by status
            if (statusFilter !== 'all') {
                if (statusFilter === 'completed') {
                    filteredStudents = filteredStudents.filter(student => student.completed);
                } else {
                    filteredStudents = filteredStudents.filter(student => !student.completed && student.status === statusFilter);
                }
            }

            // Filter by campus
            if (campusFilter !== 'all') {
                filteredStudents = filteredStudents.filter(student => {
                    if (campusFilter === 'mls') return student.campus.includes('ML Sultan');
                    if (campusFilter === 'ritson') return student.campus.includes('Ritson');
                    if (campusFilter === 'steve-biko') return student.campus.includes('Steve Biko');
                    if (campusFilter === 'b-block') return student.residence.includes('B Block');
                    if (campusFilter === 'm-block') return student.residence.includes('M Block');
                    if (campusFilter === 'brickfield') return student.residence.includes('Brickfield');
                    if (campusFilter === 'off-campus') return student.campus.includes('Off-Campus');
                    return true;
                });
            }

            // Filter by search term
            if (searchFilter) {
                filteredStudents = filteredStudents.filter(student => 
                    student.name.toLowerCase().includes(searchFilter) || 
                    student.id.includes(searchFilter)
                );
            }

            populateStudentGrid(filteredStudents);
        }

        // Mark request as completed
        function markRequestAsCompleted(studentId) {
            const studentIndex = emergencyRequests.findIndex(s => s.id === studentId);
            if (studentIndex !== -1) {
                emergencyRequests[studentIndex].completed = true;
                emergencyRequests[studentIndex].status = 'completed';
                emergencyRequests[studentIndex].completionTime = new Date().toLocaleString();
                
                updateRequestCounts();
                filterRequests(); // Refresh the grid with current filters
            }
        }

        // Action functions
        function processRequest(studentId) {
            const student = emergencyRequests.find(s => s.id === studentId);
            if (confirm(`Process emergency request for ${student.name}?\n\nCampus: ${student.campus}\nLocation: ${student.residence}, Room ${student.room}\nEmergency: ${student.emergencyType}`)) {
                markRequestAsCompleted(studentId);
                alert(`Request processed successfully!\n${student.name}'s emergency has been handled.`);
            }
        }

        function assignAmbulance(studentId) {
            const student = emergencyRequests.find(s => s.id === studentId);
            if (confirm(`Dispatch DUT ambulance to ${student.name}?\n\nCampus: ${student.campus}\nLocation: ${student.residence}, Room ${student.room}\nEmergency: ${student.emergencyType}\nPriority: ${student.priority.toUpperCase()}`)) {
                markRequestAsCompleted(studentId);
                alert(`Ambulance dispatched successfully!\nDUT ambulance is en route to ${student.residence}, Room ${student.room}`);
            }
        }

        function viewDetails(studentId) {
            const student = emergencyRequests.find(s => s.id === studentId);
            const completionInfo = student.completed ? `\nCompleted: ${student.completionTime}` : '';
            
            alert(`DUT Student Details:\n\nName: ${student.name}\nID: ${student.id}\nAge: ${student.age}\nCampus: ${student.campus}\nResidence: ${student.residence}, Room ${student.room}\n\nEmergency: ${student.emergencyType}\nSymptoms: ${student.symptoms}\nReported: ${student.timeReported}\nPriority: ${student.priority.toUpperCase()}\nStatus: ${student.completed ? 'COMPLETED' : student.status.toUpperCase()}${completionInfo}\nReference: ${student.reference}`);
        }
    </script>
</body>
</html>